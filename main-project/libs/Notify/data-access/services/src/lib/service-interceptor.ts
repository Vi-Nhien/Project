import {
  HttpErrorResponse,
  HttpEvent,
  HttpHandler,
  HttpRequest,
} from '@angular/common/http';
import { HttpInterceptor } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { EMPTY, Observable, throwError } from 'rxjs';
import { catchError } from 'rxjs/operators';

@Injectable()
export class ServiceInterceptor implements HttpInterceptor {
  // auth_token = 'eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZDQkMtSFM1MTIiLCJraWQiOiIyM0VBOTUxMkY2NjZCMDA1MUY3Q0QzN0NFMjkzMkIxN0NFMkNCODhBIiwidHlwIjoiYXQrand0In0.Muqw_jpqizYwT7YNv80T2AhplyRqxM9l6N6Hp7eTSdczSFIybwkI0--7sA2BCSBduHWmICQLcSKfFDaDqV9YfAex76drJvktuD6uO2_ZH1xgezuQaooFpBSqE0I6X3QkoelMulGHVr0b3gLYaTrKHXEbNgqJ84iGCt0RJQ74Ms-TMubC-4uuFbbbPHG27T8PfcTNOn8M0tNzsMEw3MkMvzOAGWgOFZBfakoyZoER2P6hk7lvyd9CEOUAzaRv891w4CWx7MLkXuApzk13XhLseuszaF5vsMQ0EUvlNwzldqT40sDZvbb6z7UQ-S6Oii3UDkUo0PZAFheCLRe4fNoQ-A.CLZt_LdtIUFvd_3ejkfF4Q.OfNWFvAZg_7CcFLC6Chzh7Ujhwa33aNkIWjPU76davhHl5xRCsSZEbfQQW2Y2EXlb4eQT34lhpahzrINDQwQ6jibdG_cluClMyaTTTlrpUmZNIrRNp5fWZINJBpdOSpTYl7-XZvr3dHriuWeOjQVbbSzYwd_4GI8jLwgf-qz2DC_vRV10SKh5ZBIDF2btk9HuXX1otrasyJd7Z0m4gHA-PnbGHgL2juvQ0ARwiqoC6NYKrtmbo3klxKNOvk0fTGRmzbQJTIuQ-o5-UK2e5kCFGEEySk7RIolePOZQ2B0D2Yj-Cl5Dn7mIT7IUUiBLc5tJFYplZoUClRSy3h1oY2eh3oAMCR6nhzpgaiC-o55eB9Z-m7S_-y_fvh1XLAzP3QqiDnS_7ol-HFyx7Lv_VvIfh5jB4N9EFu20VwBDLokCGqSwQ5jtCl9e5hNeV6VyULRyuTUJ0Y0GqeQBXxZKZnutFNiqrJb_y-Wt67mjf624L8yn7ZEOUYud_sqR9v-RFxTKd-TS42Q9sRawqIW1ozG-nTBGZtswRR6IJf1WY6E2xzQodEmdYM6Ihb4BrbrRN19OnSY6hfpC-CurLT0hOPK4xiG0kGUf0siIe8bu9I3JdQJxRCvTuMAxisoctzZvJBKbXLmmYYMF3pmvjUBDoso1VnoY1-mITlLSNhogDOTy9evq3bQBUYO-IMhu2sA9NniPwjR_LfOUQZ9Taz7BtkWxKWtcMjtdLBdMYH59doC388jtbXzSO0hYTbxB-YN3eBx0VmC_oboBRpJsNhdtXBFqItD0HMQruVDa93bdztdTXK2sBhvDeSHVjz-UM3DUs93OO1QXpNXm6LG6QXOt4XtruuCaINL5l3rfEihjzG-AlPVKZRMiQz3bCL0tGiP1rWHGLbcebAkNwE1weEAHCb-kcVqHU8G_hy-JJdM-VIBaVe3TgpJntiD7tywSAAZFwO5nDjx1PKPCD_WcWQTzQELi5eR0Ukd4ZHLrKUI4PiBjNaKgb5lxUN3sP7Ez0sK0PihFg-UX265HudDGfzckeJ6b99_G56bDiMnBXeITAx96O-l4E6nluH1M6Hgm1nhyrmzMGXhTcWSf9cBRaEqo7yb_3LinQdswzFzgyo8nnuC8aZZbhjNIXZW_Tp320jRhEs3gRCuB1IjrgAaMgg7EAIS0x09GOw_3bWtr9B7TVppIMlP0QV5A9nKhg4DBbu3CnCIKZyyN6kkCS6YpSfj9KS7M4UGTsdJzUGa6KE8aY3cwriRr6C4mcdk5Pb443SdC6ezWS5uSNcZUzsECllMdAhRoEvkEiAdlyRQL1S9jaUpO8NQ4C2gOi3_0B4dAMqsaNBaYTvntvv0KkPESsUhYorHTQOSkaFHjR2ndlofLn0E_3ThBiIu8qTAd8onXercxZYSN2w0NbpsIlmp9Efe2SD9HniPKPw00-ejVY57LEiiPb0kH-a2IMLQQ0qS4F-y2j1Y.rF5-ZTz71RsGWtcHP_e9sAy_2IYTJU2wNPH1e2_njlI'
  intercept(
    req: HttpRequest<unknown>,
    next: HttpHandler
  ): Observable<HttpEvent<unknown>> {


      req = req.clone({
        setHeaders: { Authorization: `Bearer eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZDQkMtSFM1MTIiLCJraWQiOiIyM0VBOTUxMkY2NjZCMDA1MUY3Q0QzN0NFMjkzMkIxN0NFMkNCODhBIiwidHlwIjoiYXQrand0In0.vgMQnRzB-ENnB7iKCPBRQEwOR68HKvFufAykHqH7RsLX4bwYvqYA7xdblHr_q-M4uVlT6NX95TvAoNvhyP6B2idwVy6Cm6H8FnDYsiFKgw6XgtSEfAgB16qx01-DaDJow5yacmaMgL3fLFGZe239C2SjUe8Z8df1wpLzJXbGgC8huTDNAQdSEeXJdJl3HNGqvNQrJN_JErKrSFZWWEtUYh11Xc4-jJlUNzn28EPAIop0PDDhrlTVeZv7cs45yHxr_kpnG5IazMMXKDyXKr9N86uDfj6w9jHLEKTHbcXoo9ZaRsDyzXiToA7bqUdpXcu0sxG6ZJNAZr4iDGKVRnjj4w.NIcVYPFr5omRaxa5rEc8WA.0Glnqz2n2YcgMtIGeU4ekVkP55PrJT91tTtfYsISV4gA4osgh9VzVsEFpDDEJIqwyYfEsCttly4zho6RSN-ZGd6cg6wOlSC1QZC1CFLlRdBIkm3jw-fIeCvi_RuBAbhVYahtYaGEagx6_FkFhB342-P3wq80-YW6ix_o6NZT6wuidHqn9plbxklWZcxYy9X4WzbsC4nFevrw58Vg4GvS2T_pWWFq47W-QrWdX4BfOnAGq0UMtPZuDsLRZDSTiKsmnGYlUCbcY9Sz-UPvfCTl4Td4xOs-8C7GxHLEBs_ZhYdJgnbGDS-EmlA7agB-C5ABrLjLYHimiaJsrGNo1GfSXI5zHvDirqQkT--g35o1F1YkILKgB3deE47hPWpZFjf9Ybz1HKtPLxrmGo2AvidbCVySkx9gXKp9e46KmuDWB74GQ11UCCMu3mlSxJt1iQJ4L2ZQSwl1MfKZfoNwubHn8awpWj010OvYXGuhfg0-nW0ho4XLDeNMRK2-zZFzpfC23eyFPdhIRaQJpKVUmC08U4VbkKISMp9DcL1Q3rU_5N2kKlqsfBzjW2fRX5rtD0kdrwBS_LajnwNmFPn1SCLcn5fbtBdZTt9ZcIelRvD7KOF4Xv_lJM42zy2H2WmYd871bl2JoQPgLfDXtMJueRZ6oLI6MsCr6Cs5W08XeHj0lP6_tkAUusIBfs2bas7ZwTeEhHOWHvtA8gMMRlrv0RwYtBdR1DPDtzkxEDc6uqWzPApr03ihysS7NhhBQwStS9WLbI6zuUPk08TV_YLywtoFIeQLxrDuWN97NuLOViE9gCLIXjCT999rInX4RgJHmJpD0f3oL6EmtBDjdiyWzBN_VPOrWrDYeYwi4fJsxbhma9kiY9khZReNJm3Xy2hUv2UUupR5Zmmd3ad2LtQwbyMfA2pDY707zgrIVbL6gdjX6BB1xfWQmnyrD22YbAYoaF2e7mM55R7kG5AnawFAg__Ga14o_ZwbqyxBRQkxKHYihLDTWNhL6dhxEerpL1mvqazL1lP4wNGE-oePSYV2pkv9VZZWQ8uMagMUbRuKmy7-Zs6kENt4ANf0mjuozyJYIgl-xAdzyEMlTYmxl1nBeREEj1NknXt3JL89y15guGyelesw1CiPc8ITzw_fLYLZTNZdgaTR-CREGihgDnxUUJqhQlR5SHuKVU3WdNv4Izh9jNb6nwYYJVpRne8Q4YxJL3DVWZvNjbS1xHcJ1ADeFgCzCc5EwfXjxcMFaj7kxjlY6CVAh7ZvfcsiudCcM0zj3-Yh7OghdOzHxhR8sJQnOWEG19NuAG98u7K7u0mkLHxz4zH4CuDOGh6tBzI09-DkXss_VfXSVAWGv-prhXctBwyedvzjFC1cZwXJVb3TlSYxhaCQoQuI-XpQsIursBiw6faR3qZ5Y5gOdAsPGdEIFZaawAaLRJqrOA1PyZm8uzeOvn0Vg2f9vgTF4_nQZ99I0ZKHSkXId40CRS2v7WUcUxFlIz99XmCP5kBkfSMmhs1eoWg.fnIBDSPG0r6_6T9nQNCV8HX-lFaX8fEWSr2jdTi8qNY
` },
      });


    return next.handle(req).pipe(s => this.handleErrors(s, req.url));
  }
  private handleErrors(
    source: Observable<HttpEvent<unknown>>,
    urlPath: string
  ): Observable<HttpEvent<unknown>> {
    return source.pipe(
      catchError((error: HttpErrorResponse) => {
        if (error.status === 401 && !urlPath.includes('/auth/')) {
          return this.handle401();
        }

        // rethrow error
        return throwError(() => error);
      })
    );
  }

  private handle401() {
    return EMPTY;
  }
}
